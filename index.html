<!-- Add algorithm. Make function creation better -->
<!-- Add CSS for combining it all -->


<!-- 1. Make it one input function bar 2. Add levels 3. figure out how to get rid
of the extra input bars 4.-->


<!-- https://stackoverflow.com/questions/13152578/create-a-draggable-div-in-native-javascript -->

<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Chain Rule</title>
    <link href="style.css" type="text/css" rel="stylesheet">
    <script src="https://d3js.org/d3.v4.min.js"></script>
  </head>
  <body>
    <header>
        <h1>
          Multivariate Chain Rule
        </h1>
        <h3>By Sam Xifaras and Malcolm Essaid</h3>
    </header>
    <div id = "container"><div>
    <div class = "sideBars" id = "leftside">
      <h5>Functions:</h5>
    </div>
    <aside class = "sideBars" id="rightside">
      <input input="text" value= "Number of Inputs" id ="bar"> <br>
      <button type="button" name="button" id="btn">Submit</button>
      <p id = "functDisplay"></p>
      <div id="textboxes"></div>
      <button type="button" name="button" id = "crtSub">Create Sub Functions </button>
      <button type="button" name="button" id = "crt">Create</button> <br>
      <button type="button" name="button" id = 'clear'>Clear</button>
    </aside>
  </body>
  <script>


  var functionSet = [];
  var valuesNaught = 0;

      var functionSet = [];
      var dragObj = null;

  const width = 750,
        height = 450,
        margin = {
            top: 10,
            bottom: 100,
            left: 100,
            right: 10,
        };

  var svg = d3.select("#container").append("svg")
      .attr("width", width)
      .attr("height", height)
      .style("margin", "0 auto")
      .style("display", "block")
      .style("overflow", "visible")
      .on("mouseup", function (d) {
          dragObj = null;
      })
        .on("mousemove", function (d) {
            var coordinates = [0, 0];
            coordinates = d3.mouse(this);
            var x = coordinates[0];
            var y = coordinates[1];

            if (dragObj == null)
                return;

            dragObj.attr("transform", "translate(" + x + "," + y + ")");

        });


  document.getElementById('clear').addEventListener('click', function(){
    svg.selectAll('circle')
      .remove();
    svg.selectAll('text')
      .remove()
  })


  document.getElementById('crtSub').addEventListener('click', function(){
    var set = document.getElementsByClassName('subFunction');
    for (var i = 0; i < set.length; i++) {
      functionSet.push([set[i].value, 1])
      var x = document.createElement('p');
      x.innerHTML = '\n'+set[i].value;
      x.style.margin =0;
      document.getElementById('leftside').appendChild(x);
    }
  })
  document.getElementById('bar').addEventListener("click", function(){
    document.getElementById('bar').value = "";
  });
  document.getElementById('btn').addEventListener("click", function(){
    var x = document.getElementById('bar').value;
    if (x != "Number of Inputs" && !isNaN(x) && x < 26){
      document.getElementById('functDisplay').innerHTML = (createTextofFucntion(x,0))
      valuesNaught = x;
      for (var i = 0; i < valuesNaught; i++) {
        var abc = "xyzwvutsrqponmlkjihgfedcba";
        var x = document.createElement("input");
        x.classList.add("subFunction");
        x.value = abc.charAt(i)+ " = ";
        document.getElementById('textboxes').appendChild(x)
      }
    }
    if (isNaN(x)){
      document.getElementById('bar').value = "Please put in a number"
    }
    if (x > 26){
      document.getElementById('bar').value = "Pick a Lower Number"
    }
  });

// Creates all Functions
  document.getElementById('crt').addEventListener('click', function(){
    createFunction();
  })


// Creates the top Function.
  function createTextofFucntion(n, level){
    var abc = "yzwvutsrqponmlkjihgfedcba";
    var inputFun = "x";
    for (var i = 0; i < n - 1; i++) {
      inputFun = inputFun + ", " + abc.charAt(i);
    }
    inputFun = "F(" + inputFun + ")";
    var temp = [inputFun, level];
    functionSet.push(temp)
    return (inputFun)

  }

  function createFunction(){
      var group = svg.selectAll("g")
        .data(functionSet)
        .enter()
        .append("g")
        .attr("transform", "translate(" + 100 + "," + 100 + ")")
        .on("mousedown", function (d) {
            dragObj = d3.select(this);
        });
      group.append("circle")
        .style('fill', "#e0e0e0")
        .attr('r', 40)
        .attr("cx", 0)
        .attr("cy", 0)
      group.append("text")
        .attr("x", 0)
        .attr("y", 0)
        .attr("text-anchor", "middle")
        .html(function (d) {
            return d[0];
        });
  }



  </script>

</html>
